# Glitch

> Glitch is a tool for managing and generating error codes.

- Generate a YAML file as a template for the error code. You can define all error codes in this YAML file.

- Generate code based on the YAML file to declare errors in the program. In this way, the error code can be easily referenced in the code.

- Generate an error code map, which is convenient to return the corresponding error information according to different languages when returning the response.

## Install

```bash
go install github.com/kalifun/glitch@latest
```

## How to use

### gen template

```bash
glitch init
```

### edit file

```yaml
error:
  - key: MissingParameterF
    code: MissingParameter
    message:
      cn: "缺少参数: %s"
      en: "Missing Parameter: %s"
```

### gen code

```bash
glitch gen -y errors.yaml -p errors
```

You will find that the file has been generated `errors/code.go`

```go
// Code generated by glitch. DO NOT EDIT!
package errors

import "github.com/kalifun/glitch/repo/gerr"

var missingParameterF = gerr.ErrorCode{
 Key:  "MissingParameterF",
 Code: "MissingParameter",
 Message: gerr.ErrorMessage{
  CN: "缺少参数: %s",
  EN: "Missing Parameter: %s",
 },
}

func init() {
 gerr.CreateError(missingParameterF)
}

var MissingParameterF = gerr.New("MissingParameterF", "MissingParameter", "Missing Parameter: %s")
```

You can use the defined error code.

```go
func demo() error {
 return errors.MissingParameterF.Args("User")
}
```

### Handlers

#### Gin Handler

```go
package main

import (
 "gindemo/errors"

 "github.com/gin-gonic/gin"
 "github.com/kalifun/glitch/repo/gerr"
)

func main() {
 router := gin.Default()
 router.Use(gerr.ErrorFilter())
 router.GET("/ping", func(c *gin.Context) {
  c.Error(errors.MissingParameterF.Args("User"))
 })
 router.Run() // 监听并在 0.0.0.0:8080 上启动服务
}

```

```bash
❯ curl http://127.0.0.1:8080/ping
{"error":{"code":"MissingParameter","message":"Missing Parameter: User"}}
```
